<!-- Scaffolding generated by Casein v5.1.1.5 -->

<h2>View course</h2>

<%= form_for @course, :url => casein_course_path(@course), html: {multipart: true} do |f| %>

	<%= render :partial => 'casein/courses/form', :locals => { :f => f } %>
	
	<p class="submits">
	  	<%= link_to 'Cancel', casein_courses_path, :class => 'btn btn-mini btn-danger' %>
		<%= f.submit "Save changes", :class => "btn btn-mini btn-primary" %>
	</p>

<% end %>

	<div class = '.container-fluid'>
		<%= form_tag update_multiple_casein_photos_path do %>

		<label class = 'control-label'>Current <%= @course.name %> photos </label>
			<% if @course.photos.present? %>
				<%= submit_tag 'Remove photos', :class => 'btn btn-mini btn-danger pull-right sub-btn' %>
				<br class = 'clr' />
				<i>click on the photos to select</i>
				<br />
				<br class = 'clr' />
					<div class = 'row'>
						<% @course.photos.each do |photo| %>
							<div class = 'col-xs-6 col-md-3 container thumb'>
								<%= check_box_tag "photo[photo_ids][]", photo.id, checked = false, {:class => 'cbox', id: dom_id(photo)} %>
								<%= image_tag photo.image_url(:thumb).to_s, :class => 'thumbnail image-select' %>
							</div>
						<% end %>
						<%= hidden_field_tag 'imageable[imageable_id]', nil %>
						<%= hidden_field_tag 'imageable[imageable_type]', nil %>
						<%= hidden_field_tag 'origin[origin_type]', @course.class_name %>
						<%= hidden_field_tag 'origin[origin_id]', @course.id %>
					</div>
			<% else %>
				<br />
				<i>There are currently no photos for <%= @course.name %></i>
			<% end %>
		<% end %>
	</div>


<%= content_for :sidebar do %>
	<li><%= link_to "#{casein_show_icon "th-list"}Back to list".html_safe, casein_courses_path %></li>
	<br >
	<h4>Upload new photos</h4>
	<%= form_for @photo, :url => imageable_create_casein_photos_path, html: { :class => 'dropzone', :id => 'my-awesome-dropzone'} do |f| %>
		<%= casein_hidden_field f, f.object, :imageable_id, value: @course.id %>
		<%= casein_hidden_field f, f.object, :imageable_type, value: @course.class_name %>
	<% end %>
	<br />
	<hr />
	<button type="button" class="btn btn-mini btn-primary" data-toggle="modal" data-target="#myModal">
		  Add Photos from Gallery
	</button>
<% end %>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Add Existing Photos from Gallery</h4>
      </div>
      <%= form_tag update_multiple_casein_photos_path do %>
      <div class="modal-body">
		<i>Click a photo to select...</i><br />
			<br class = 'clr' />
			<div class = 'row'>
				<% @photos.where(imageable_id: nil).each do |photo| %>
					<div class = 'col-xs-6 col-md-4 container thumb'>
						<%= check_box_tag "photo[photo_ids[]", photo.id, checked = false, {:class => 'cbox', id: dom_id(photo)} %>
						<%= image_tag photo.image_url(:thumb).to_s, :class => 'thumbnail image-select' %>
					</div>
				<% end %>
			</div>
				<%= hidden_field_tag 'imageable[imageable_id]', @course.id %>
				<%= hidden_field_tag 'imageable[imageable_type]', @course.class_name %>
	   </div>
	   <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <%= submit_tag 'Add photos', :class => 'btn btn-mini btn-primary sub-btn' %>
	   </div>
      <% end %>
    </div>
  </div>
</div>

<script>
	$(document).ready(function() {
		Dropzone.options.myAwesomeDropzone = {
			paramName: 'photo[images][]',
			uploadMultiple: false,
			clickable: true,
			acceptedFiles: 'image/*'
		};

		$(".container .cbox").hide();
		$('.image-select').click(function() {
			var $checkbox = $(this).parent().find('.cbox');
			$(this).toggleClass('selected');
			$checkbox.prop('checked', !$checkbox.prop('checked'));
			$('.sub-btn').prop('disabled', !$(':checkbox:checked').length);
		});
		$(':checkbox').on('change', function () {
    		$('.sub-btn').prop('disabled', !$(':checkbox:checked').length);
		}).change();

	})
</script>