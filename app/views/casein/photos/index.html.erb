<!-- Scaffolding generated by Casein v5.1.1.5 -->

<h2>Photos<%= casein_pagination_details @photos %></h2>
<span class="instruction-text">(click on a photo to edit details.)</span>

	<%= form_for @photo, :url => casein_photos_path, html: { :class => 'dropzone', :id => 'my-awesome-dropzone-index'} do |f| %>
		<div class = 'row dropzone-previews'>
		<% @photos.each do |photo| %>
			<div class = 'col-xs-6 col-sm-4 col-md-3'>
	 			<%= link_to casein_photo_path(photo), remote: true do %>
					<%= image_tag photo.image_url(:thumb).to_s, :class => 'thumbnail img-select' %>
	 			<% end %>
			</div>
		<% end %>
		</div>
	<% end %>
		
<div class="text-center">
	<%= will_paginate @photos %>
</div>

<%= content_for :sidebar do %>

	<li><%= link_to "#{casein_show_icon "plus-sign"}Add a new photo".html_safe, new_casein_photo_path %></li>
	<div id='photo-load'></div><br />
	<hr />
	Download Data: <%= link_to 'CSV', casein_photos_path(format: 'csv') %> | 
	<%= link_to 'Excel', casein_photos_path(format: 'xlsx') %>	
	<br />
	<br />
	<%= form_tag import_casein_photos_path, multipart: true do %>
		<%= file_field_tag :file, accept: 'text/csv' %>
		<%= submit_tag "Import", :class => 'btn btn-xs btn-primary pull-right' %>
	<% end %>
<% end %>

<script>
	$(document).ready(function() {
		Dropzone.options.myAwesomeDropzoneIndex = {
			init: function() {
				this.on("thumbnail", function (file) {
					$(".dz-preview").addClass("col-xs-6 col-sm-4 col-md-3");
					$(".dz-image img").addClass("thumbnail");
				});
				this.on("success", function (file, responseText) {
					var id = responseText.id;
					$(".dz-preview").click(function() {
						$.ajax({
							url: '/casein/photos/'+id 
						})
					});
				})
			},
			paramName: 'photo[image]',
			uploadMultiple: false,
			clickable: true,
			acceptedFiles: 'image/*',
			previewsContainer: '.dropzone-previews',
			thumbnailWidth: '150',
			thumbnailHeight: '150'
		};

	})
</script>